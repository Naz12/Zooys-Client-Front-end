<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Available Options Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Available Options Fix Test</h1>
        <p>This test verifies that the available options loading issue has been fixed.</p>
        
        <div class="test-section">
            <h3>üß™ Test 1: Default Options</h3>
            <p>Test that the component works with default options without API calls.</p>
            <button onclick="testDefaultOptions()">Test Default Options</button>
            <div id="testDefaultResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîç Test 2: API Endpoints Check</h3>
            <p>Check if the topics and difficulties API endpoints exist.</p>
            <button onclick="testAPIEndpoints()">Check API Endpoints</button>
            <div id="testAPIResult" class="result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test 3: Math API with Default Options</h3>
            <p>Test the math API using the default options.</p>
            <button onclick="testMathWithDefaults()">Test Math API</button>
            <div id="testMathResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000/api';
        
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${type}`;
            element.textContent = content;
        }

        function testDefaultOptions() {
            const defaultTopics = ['arithmetic', 'algebra', 'geometry', 'calculus', 'statistics'];
            const defaultDifficulties = ['beginner', 'intermediate', 'advanced'];
            
            const result = `Default Options Test:
Available Topics: ${JSON.stringify(defaultTopics, null, 2)}
Available Difficulties: ${JSON.stringify(defaultDifficulties, null, 2)}

‚úÖ Default topics include 'arithmetic' (valid for API)
‚úÖ Default difficulties include 'beginner' (valid for API)
‚úÖ No API calls needed for basic functionality
‚úÖ Component will work even if API endpoints don't exist

This approach ensures:
- No console errors from missing API endpoints
- Valid subject areas for the math API
- Graceful fallback to working defaults
- Better user experience`;
            
            showResult('testDefaultResult', result, 'success');
        }

        async function testAPIEndpoints() {
            showResult('testAPIResult', 'Checking API endpoints...', 'info');
            
            const results = [];
            
            // Test topics endpoint
            try {
                const topicsResponse = await fetch(`${API_BASE_URL}/client/math/topics`, {
                    headers: {
                        'Accept': 'application/json',
                        'Origin': 'http://localhost:3000',
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || 'no-token'}`
                    },
                    redirect: 'manual'
                });
                
                if (topicsResponse.ok) {
                    const topics = await topicsResponse.json();
                    results.push(`‚úÖ Topics endpoint working: ${JSON.stringify(topics)}`);
                } else {
                    results.push(`‚ùå Topics endpoint failed: ${topicsResponse.status}`);
                }
            } catch (error) {
                results.push(`‚ùå Topics endpoint error: ${error.message}`);
            }
            
            // Test difficulties endpoint
            try {
                const difficultiesResponse = await fetch(`${API_BASE_URL}/client/math/difficulties`, {
                    headers: {
                        'Accept': 'application/json',
                        'Origin': 'http://localhost:3000',
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || 'no-token'}`
                    },
                    redirect: 'manual'
                });
                
                if (difficultiesResponse.ok) {
                    const difficulties = await difficultiesResponse.json();
                    results.push(`‚úÖ Difficulties endpoint working: ${JSON.stringify(difficulties)}`);
                } else {
                    results.push(`‚ùå Difficulties endpoint failed: ${difficultiesResponse.status}`);
                }
            } catch (error) {
                results.push(`‚ùå Difficulties endpoint error: ${error.message}`);
            }
            
            const result = `API Endpoints Check:
${results.join('\n')}

Summary:
- If both endpoints work: API can be used for dynamic options
- If endpoints fail: Default options will be used (which is fine)
- The component will work either way`;
            
            const hasWorkingEndpoints = results.some(r => r.includes('‚úÖ'));
            showResult('testAPIResult', result, hasWorkingEndpoints ? 'success' : 'warning');
        }

        async function testMathWithDefaults() {
            showResult('testMathResult', 'Testing math API with default options...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/math/solve`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Origin': 'http://localhost:3000',
                        'Authorization': `Bearer ${localStorage.getItem('auth_token') || 'no-token'}`
                    },
                    body: JSON.stringify({
                        problem_text: '2+2',
                        subject_area: 'arithmetic',  // Using default
                        difficulty_level: 'beginner', // Using default
                        problem_type: 'text'
                    }),
                    redirect: 'manual'
                });
                
                let result = `Math API with Default Options Test:
Problem: "2+2"
Subject Area: arithmetic (default)
Difficulty Level: beginner (default)
Status: ${response.status}
Type: ${response.type}`;
                
                if (response.ok) {
                    const data = await response.json();
                    result += `\n\n‚úÖ Success Response:
${JSON.stringify(data, null, 2)}`;
                    showResult('testMathResult', result, 'success');
                } else {
                    const errorText = await response.text();
                    result += `\n\n‚ùå API Error (${response.status}):
${errorText}`;
                    showResult('testMathResult', result, 'error');
                }
            } catch (error) {
                showResult('testMathResult', `‚ùå Request failed: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
